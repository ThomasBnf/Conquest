generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

enum PLAN {
    EXPLORER
    ACTIVE
    CONTRIBUTOR
    AMBASSADOR
}

enum REASON {
    EMAIL
    NAME
    USERNAME
}

enum ROLE {
    STAFF
    ADMIN
}

enum SOURCE {
    Api
    Discourse
    Discord
    Github
    Linkedin
    Livestorm
    Manual
    Slack
    Twitter
}

enum STATUS {
    ENABLED
    CONNECTED
    SYNCING
    DISCONNECTED
}

enum STATE {
    PENDING
    APPROVED
    REJECTED
}

model Account {
    id                String  @id @default(cuid())
    userId            String  @map("user_id")
    type              String
    provider          String
    providerAccountId String  @map("provider_account_id")
    refresh_token     String? @db.Text
    access_token      String? @db.Text
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String? @db.Text
    session_state     String?

    user user @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
    @@map("accounts")
}

model api_key {
    id    String @id @default(uuid())
    name  String
    token String @unique

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())

    @@index([id])
    @@index([workspaceId])
}

model duplicate {
    id          String    @id @default(uuid())
    memberIds   String[]
    reason      REASON
    state       STATE
    totalPulse  Int       @default(0)
    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([workspaceId])
}

model event {
    id         String    @id @default(uuid())
    externalId String    @unique
    title      String
    startedAt  DateTime
    endedAt    DateTime?
    source     SOURCE

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([id, workspaceId])
    @@index([source, workspaceId])
}

model integration {
    id           String    @id @default(uuid())
    externalId   String?   @unique
    connectedAt  DateTime?
    status       STATUS
    details      Json
    triggerToken String
    expiresAt    DateTime
    runId        String?
    createdBy    String

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([id, workspaceId])
    @@index([externalId])
}

model list {
    id           String @id @default(uuid())
    emoji        String
    name         String
    groupFilters Json   @default("{\"filters\":[],\"operator\":\"AND\"}")
    createdBy    String

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([createdBy, workspaceId])
    @@index([id, workspaceId])
}

model post {
    id         String @id @default(cuid())
    externalId String
    content    String
    authorId   String

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())

    @@unique([externalId, workspaceId])
    @@index([externalId, workspaceId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique @map("session_token")
    userId       String   @map("user_id")
    expires      DateTime
    user         user     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("sessions")
}

model tag {
    id         String  @id @default(uuid())
    externalId String?
    name       String
    color      String
    source     SOURCE

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([externalId, workspaceId])
    @@index([id, workspaceId])
    @@index([workspaceId])
}

model user {
    id                   String    @id @default(cuid())
    email                String    @unique
    emailVerified        DateTime? @map("email_verified")
    firstName            String?
    lastName             String?
    avatarUrl            String?
    onboarding           DateTime?
    role                 ROLE      @default(ADMIN)
    lastActivityAt       DateTime  @updatedAt
    membersPreferences   Json      @default("{\"id\":\"level\",\"desc\":true,\"groupFilters\":{\"filters\":[],\"operator\":\"AND\"},\"columnVisibility\":{},\"columnOrder\":[]}")
    companiesPreferences Json      @default("{\"id\":\"name\",\"desc\":false,\"groupFilters\":{\"filters\":[],\"operator\":\"AND\"},\"columnVisibility\":{},\"columnOrder\":[]}")
    workspaceId          String
    workspace            workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    accounts        Account[]
    sessions        Session[]
    userInWorkspace userInWorkspace[]

    @@index([id])
    @@index([email])
}

model userInWorkspace {
    id          String    @id @default(uuid())
    userId      String
    user        user      @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
    @@index([workspaceId])
}

model userInvitation {
    id          String    @id @default(uuid())
    email       String
    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([workspaceId])
}

model VerificationToken {
    id         String   @id @default(uuid())
    identifier String
    token      String
    expires    DateTime

    @@unique([identifier, token])
    @@map("verification_tokens")
}

model workflow {
    id          String    @id @default(uuid())
    name        String
    description String?
    nodes       Json[]
    edges       Json[]
    published   Boolean   @default(false)
    lastRunAt   DateTime?

    workspaceId String
    workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([id, workspaceId])
    @@index([workspaceId])
}

model workspace {
    id               String    @id @default(uuid())
    name             String
    slug             String    @unique
    source           String?
    companySize      String?
    plan             PLAN?
    stripeCustomerId String?
    priceId          String?
    trialEnd         DateTime?
    isPastDue        DateTime?

    api_keys        api_key[]
    events          event[]
    integrations    integration[]
    lists           list[]
    post            post[]
    tags            tag[]
    user            user[]
    workflows       workflow[]
    duplicates      duplicate[]
    userInWorkspace userInWorkspace[]

    createdAt      DateTime         @default(now())
    updatedAt      DateTime         @updatedAt
    userInvitation userInvitation[]

    @@index([id])
}
